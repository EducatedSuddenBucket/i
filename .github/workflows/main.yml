name: Rename Image File

on:
  push:  # Trigger on any file change in the repository
    paths:
      - '**/*'
  workflow_dispatch:  # Allow manual triggering of the workflow

jobs:
  rename-file:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Generate random filename
        id: random-filename
        run: |
          RANDOM_FILENAME=$(cat /dev/urandom | tr -dc 'a-z0-9' | fold -w 5 | head -n 1).png
          echo "RANDOM_FILENAME=${RANDOM_FILENAME}" >> $GITHUB_ENV
          echo "Generated random filename: ${RANDOM_FILENAME}"

      - name: List files in img directory before rename
        run: ls -la img

      - name: Rename image file
        run: mv img/image.png img/$RANDOM_FILENAME

      - name: List files in img directory after rename
        run: ls -la img

      - name: Commit changes
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add img/
          git commit -m "Renamed image.png to $RANDOM_FILENAME"
          git push
